<!DOCTYPE html>
<html lang="en">

<head>
    {{>header}}
    <link rel="stylesheet" href="/css/cart.css">
</head>

<body>
    {{>navbar}}
    <div class="cart">
        <div class="cart-content">

            <div class="content">
                {{#if products.length}}

                {{else}}
                <div class="empty">
                    <h2
                        style="color: rgb(86, 79, 79); font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">
                        Seems like your cart is empty!!!!!!</h2>
                    <a href="/"><button class="btn btn-success">Go To Home Page</button></a>
                </div>
                {{/if}}
                {{#each products}}
                <div class="cardPartial">
                    <div class="product-image">
                        <img src={{product.imageUrl}} alt="">
                    </div>
                    <a href="/productDetails/{{product._id}}">
                        <div class="product-info">
                            <h3>{{product.name}}</h3>
                            <p style="color: red;" class="product-price">Rs. {{product.price}}</p>
                            <div class="buttons">
                                <a href="/removeFromCart/{{product._id}}"><button class="btn btn-danger">Remove from
                                        cart</button></a>
                            </div>
                        </div>

                    </a>
                    <div class="product-quantity">
                        <div class="product-info-quantity">
                            <b>Edit Quantity :</b>
                            <input type="number" class="quantity-input" value="{{quantity}}" min="1"
                                data-price="{{price}}" placeholder="">
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
        <div class="bill">
            <h3>Cart Summary</h3>
            <form action="/checkout/:" method="post">
                <div class="total">
                    <p><b>Total Price: Rs. <span id="total-price">0 </span></b> </p>
                    <p><b>GST (18%): Rs. <span id="gst-amount">0</span></b> </p>
                    <p><b>Final Amount: Rs. <span id="final-amount">0</span></b> </p>

                    <input type="hidden" name="finalAmount" id="final-amount-input" value="0">

                    <button class="btn btn-success" style="width: 100%;" type="submit">Checkout</button>
                </div>
            </form>
        </div>
    </div>
    {{>footer}}
    <script>script src = "https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity = "sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin = "anonymous" >
    </script>

    <script>
            document.addEventListener('DOMContentLoaded', () => {
                function calculateTotalPrice() {~
                    const prices = document.querySelectorAll('.product-price');
                    let total = 0;
                    prices.forEach(priceElement => {
                        const priceText = priceElement.textContent.replace('Rs. ', '').trim();
                        const price = parseFloat(priceText);
                        if (!isNaN(price)) {
                            total += price;
                        }
                    });

                    const gst = total * 0.18; // 18% GST
                    const finalAmount = total + gst;

                    document.getElementById('total-price').textContent = total.toFixed(2);
                    document.getElementById('gst-amount').textContent = gst.toFixed(2);
                    document.getElementById('final-amount').textContent = finalAmount.toFixed(2);

                    // Update the hidden input field
                    document.getElementById('final-amount-input').value = finalAmount.toFixed(2);
                }

                calculateTotalPrice();

                const quantityInputs = document.querySelectorAll('.quantity-input');
                quantityInputs.forEach(input => {
                    input.addEventListener('change', () => {
                        const unitPrice = parseFloat(input.getAttribute('data-price'));
                        const quantity = parseInt(input.value, 10);
                        if (!isNaN(unitPrice) && !isNaN(quantity) && quantity > 0) {
                            const productPriceElement = input.closest('.cardPartial').querySelector('.product-price');
                            const newPrice = unitPrice * quantity;
                            productPriceElement.textContent = `Rs. ${newPrice.toFixed(2)}`;
                            calculateTotalPrice();
                        }
                    });
                });
            });
    </script>

</body>

</html>